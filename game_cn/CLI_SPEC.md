# CLI_SPEC.md — 迷雾边境：玩家命令行输入规范

> **版本**: v2.0 | **用途**: 玩家输入协议 | **目标**: 减少歧义、提高检索命中率

---

## A) 基本格式

一条输入 = 一个 `[标签]{内容}` 或 `[标签]"内容"` 组合：

```txt
[行动]{检查锁门，观察门框结构}
[对话]"你是谁？"
[战斗]{先发制人，偷袭门口生物}
[管理]{检查背包}
[内心]{学者}  ← 触发内心声音
<OOC> DC是多少？
```

### 特殊控制指令（不进剧情）

- **`<初始化>`**：开始新战役初始化。流程：先用对话收集偏好/PC/开局钩子 → 确认后自动执行 `python3 scripts/campaign_manager.py init ...` 落盘。**支持 `--from answers.json` 导入 JSON 格式答案**（JSON keys 映射见 INIT_PROTOCOL.md §1.1）。
- `<新战役 campaign_0002>`：创建并切换到新战役（AI 执行脚本与符号链接切换）
- `<切换战役 campaigns/campaign_0001>`：切换到已有战役（AI 执行符号链接切换）
- `<热启动>` / `<继续>`：按 `HOT_START.md` 恢复并继续

**双层系统**：
- `[标签]`：告诉 DM 你的行动类型（推荐）
- `@domain /cmd`：系统内部路由（可选；当你想明确“加载哪套规则/资料”时使用）

---

## B) 标签详解

| 标签 | 别名 | 用途 | 何时用 |
|------|------|------|--------|
| `[行动]` | `[a]` | 做事 | 移动/调查/施法/潜行/撬锁/使用物品 |
| `[对话]` | `[d]` | 说话 | 只说话不算行动，必要时DM要求补[行动] |
| `[战斗]` | `[cb]` | 打架 | 进入/继续战斗行动 |
| `[管理]` | `[m]` | 后勤 | 物品/休息/钱/统治面板 |
| `[内心]` | `[i]` | 内心 | 选择: 学者/创伤/怀疑/疲惫/警觉 |
| `[OOC]` | `<OOC>` | 问规则 | 规则/系统/设定问题 |

### 示例

```txt
[行动]{检查锁门，看有没有撬痕}
[对话]"神父，那七个人是谁？"
[战斗]{睡眠术覆盖门口，然后后撤}
[管理]{休息1小时，恢复生命}
[内心]{学者} ← 触发学者的内心声音
<OOC> 这个锁DC是多少？
```

---

## C) @domain 域标签（可选，系统内部用）

如果玩家想明确指定场景类型，可以在标签前加 `@domain`：

```txt
@scene [行动]{移动到地下室}
@invest [行动]{系统性调查血迹}
@social [对话]{询问神父}
@combat [战斗]{战斗回合}
@manage [管理]{盘点物品}
```

**为什么要加 @domain？** 就像 FC 游戏换卡带——告诉系统加载什么规则和资料；但你不加也能玩，DM 会自动推断并提示。

| 域 | 别名 | 触发场景 |
|----|------|----------|
| `@scene` | `@sc` | 移动/观察/一般行动 |
| `@social` | `@so` | 与NPC对话/谈判 |
| `@invest` | `@iv` | 系统性调查/推理 |
| `@combat` | `@cb` | 战斗遭遇 |
| `@manage` | `@ma` | 物资/交易/休息/势力 |

---

## D) 别名系统（你不需要记ID）

**你只需要用自然语言**，系统会自动匹配到正确的ID：

| 你可以写 | 系统识别为 |
|----------|------------|
| "采石场" / "锁门" / "地下室" | 自动映射到 `loc_xxx` |
| "马库斯神父" / "以利亚" / "Marcus" | 自动映射到 `npc_xxx` |
| "探索采石场" / "调查他们" | 自动映射到 `quest_xxx` |

如果出现歧义，DM会给你一个**HUD短码菜单**让你选。

---

## E) HUD短码菜单

每回合结束时，DM会输出HUD短码菜单：

```markdown
【可交互目标】
L1: 锁门（锈蚀铁锁） | L2: 工具棚（弃置）
N1: 以利亚（结盟） | N2: 莱因霍尔德（新交）
I1: 手套（菲姆法庭） | I2: 油灯
Q1: 探索采石场 | Q2: 调查他们
```

**你可以用短码直接输入**：

```txt
[行动]{与 N1 交谈}
[行动]{检查 I1}
[行动]{去 L2}
```

**短码规则**：
- `L#` 地点点位（Location target）
- `N#` NPC
- `I#` 物品/线索（Item）
- `Q#` 任务（Quest）

> 兼容：旧文档里的 `P#` 视作 `L#` 的别名（DM 会自动识别）。

---

## F) 内心对话系统

触发内心声音时，用 `[内心]{选择: xxx}`：

| 选项 | 触发条件 |
|------|----------|
| `[内心]{学者}` | 知识/推理/观察时 |
| `[内心]{创伤}` | 家人/饥荒/普鲁士相关 |
| `[内心]{怀疑}` | 信仰/教会/上帝相关 |
| `[内心]{疲惫}` | 旅途/饥饿/寒冷时 |
| `[内心]{警觉}` | 危险/潜行时 |
| `[内心]{情感}` | 心动/亲密/羞耻/嫉妒/思念/失落等情感波动时 |
| `[内心]{圣灵}` | 祈祷/忏悔/道德抉择/异象征兆/圣所氛围触发时 |

示例：`[内心]{学者}` → DM会插入学者的内心独白

---

## G) Risk 与 DC 对照

| risk | DC范围 | 失败代价 |
|------|--------|----------|
| `low` | 10-12 | 轻（时间/小噪音/小资源） |
| `mid` | 13-16 | 中（Rumor/Heat上升/受伤/丢资源） |
| `high` | 17-20+ | 重（法律后果/Debt+/剧情转折） |

---

## H) 快速示例

### 1) 撬门
```
[行动]{检查锁门，看有没有撬痕} --risk mid
```

### 2) 询问NPC
```
[对话]"神父，那七个人是谁？"
```

### 3) 系统性调查
```
[行动]{检查地面血迹，推断来了多久} --risk mid --intent "找出最近有人来过的证据"
```

### 4. 召回线索
```
<OOC> 召回关于裂隙移动规律的线索
```

### 5) 战斗回合
```
[战斗]{睡眠术覆盖门口，然后后撤5米}
```

### 6) 使用物品
```
[行动]{点燃油灯，照亮通道} --intent "照明"
```

### 7) 查看状态
```
[管理]{状态}
```

### 8) 使用HUD短码（推荐）
```
[行动]{与 N1 交谈}
```

### 9) 内心触发
```
[内心]{学者} ← DM会自动插入学者声音
```

---

## I) 玩家友好规则

1. **用自然语言**：说"锁门"而不是 `loc_xxx`
2. **加[标签]**：让我知道你到底想干嘛类型
3. **需要帮助时**：看HUD短码菜单，直接复制粘贴
4. **OOC问题**：用 `<OOC>` 标签
5. **新战役**：用 `<初始化>` 开始配置（角色与偏好）

---

*CLI_SPEC.md v2.0 - 迷雾边境编年史：瞬变*
