# CLI_SPEC.md — 玩家命令行输入规范

> **版本**：v2.0 | **用途**：玩家输入协议 | **目标**：减少歧义，提高检索命中率

---

## A) 基本格式

一条输入 = 一个 `[标签]{内容}` 或 `[标签]"内容"` 组合：

```txt
[行动]{检查锁着的门，观察门框结构}
[对话]"你是谁？"
[战斗]{先发制人，伏击门口的生物}
[管理]{检查背包}
[内心]{学者}  ← 触发内心声音
<OOC> DC 是多少？
```

### 特殊控制指令（不进剧情）

- **`<初始化>`**：开始新战役初始化。流程：先用对话收集偏好/PC/开场钩子 → 确认后自动执行 `python3 scripts/campaign_manager.py init ...` 持久化。**支持 `--from answers.json`** 导入 JSON 格式答案（JSON 键映射见 INIT_PROTOCOL.md 第 1.1 节）。
- `<新战役 campaign_0002>`：创建并切换到新战役（AI 执行脚本与符号链接切换）
- `<切换战役 campaigns/campaign_0001>`：切换到已有战役（AI 执行符号链接切换）
- `<热启动>` / `<继续>`：按 `HOT_START.md` 恢复并继续

**双系统**：
- `[标签]`：告诉 DM 你的行动类型（推荐）
- `@domain /cmd`：系统内部路由（可选；当你明确想"加载哪些规则/材料"时使用）

---

## B) 标签详情

| 标签 | 别名 | 用途 | 使用时机 |
|-----|-------|---------|-------------|
| `[行动]` | `[a]` | 做事情 | 移动/调查/施法/潜行/开锁/使用物品 |
| `[对话]` | `[d]` | 说话 | 只是说话不计入行动，DM 可能要求补充 `[行动]` |
| `[战斗]` | `[cb]` | 战斗 | 进入/继续战斗行动 |
| `[管理]` | `[m]` | 后勤 | 物品/休息/金钱/治理面板 |
| `[内心]` | `[内心]` | 内心 | 选择：学者/创伤/怀疑/疲惫/警觉 |
| `[OOC]` | `<OOC>` | 询问规则 | 规则/系统/设定问题 |

### 示例

```txt
[行动]{检查锁着的门，寻找撬痕}
[对话]"神父，那七个人是谁？"
[战斗]{用睡眠术覆盖门口，然后撤退}
[管理]{休息 1 小时，恢复生命值}
[内心]{学者} ← 触发学者的内心独白
<OOC> 这个锁的 DC 是多少？
```

---

## C) @domain 域标签（可选，系统内部使用）

如果玩家想明确指定场景类型，可以在标签前添加 `@domain`：

```txt
@场景 [行动]{移动到地下室}
@调查 [行动]{系统性地调查血迹}
@社交 [对话]{询问神父}
@战斗 [战斗]{战斗回合}
@管理 [管理]{物品栏}
```

**为什么添加 @domain？** 像 FC 游戏换卡带 —— 告诉系统要加载什么规则和材料；但你可以不带它玩，DM 会自动推断并提示。

| 域 | 别名 | 触发场景 |
|--------|-------|---------------|
| `@场景` | `@sc` | 移动/观察/一般行动 |
| `@社交` | `@so` | NPC 对话/谈判 |
| `@调查` | `@iv` | 系统性调查/推理 |
| `@战斗` | `@cb` | 战斗遭遇 |
| `@管理` | `@ma` | 补给/交易/休息/势力 |

---

## D) 别名系统（你不需要记住 ID）

**你只需要使用自然语言**，系统会自动映射到正确的 ID：

| 你可以写 | 系统识别为 |
|---------------|----------------------|
| "采石场" / "锁着的门" / "地下室" | 自动映射到 `loc_xxx` |
| "马库斯神父" / "以利亚" / "马库斯" | 自动映射到 `npc_xxx` |
| "探索采石场" / "调查他们" | 自动映射到 `quest_xxx` |

如果出现歧义，DM 会给你 **HUD 短码菜单** 让你选择。

---

## E) HUD 短码菜单

每回合结束时，DM 输出 HUD 短码菜单：

```markdown
[交互目标]
L1：锁着的门（生锈的铁锁）| L2：工具棚（废弃的）
N1：以利亚（同盟）| N2：莱因霍尔德（新相识）
I1：手套（费姆法庭）| I2：油灯
Q1：探索采石场 | Q2：调查他们
```

**你可以直接使用短码输入**：

```txt
[行动]{与 N1 对话}
[行动]{检查 I1}
[行动]{前往 L2}
```

**短码规则**：
- `L#` 地点节点（地点目标）
- `N#` NPC
- `I#` 物品/线索
- `Q#` 任务

> 兼容性：旧文档中的 `P#` 被视为 `L#` 的别名（DM 会自动识别）。

---

## F) 内心对话系统

用 `[内心]{选择: xxx}` 触发内心声音：

| 选项 | 触发条件 |
|--------|-------------------|
| `[内心]{学者}` | 知识/推理/观察 |
| `[内心]{创伤}` | 家庭/饥荒/相关 |
| `[内心]{怀疑}` | 信仰/教堂/上帝相关 |
| `[内心]{疲惫}` | 旅行/饥饿/寒冷 |
| `[内心]{警觉}` | 危险/潜行 |
| `[内心]{情绪}` | 情绪波动：吸引/亲密/羞耻/嫉妒/渴望/失落 |
| `[内心]{圣灵}` | 祈祷/忏悔/道德选择/奇异预兆/圣地氛围触发 |

示例：`[内心]{学者}` → DM 插入学者的内心独白

---

## G) 风险与 DC 参考

| 风险 | DC 范围 | 失败代价 |
|------|----------|--------------|
| `低` | 10-12 | 轻微（时间/小噪音/小资源） |
| `中` | 13-16 | 中等（传闻/热度上升/受伤/损失资源） |
| `高` | 17-20+ | 严重（法律后果/债务+/情节转折） |

---

## H) 快速示例

### 1) 开锁
```
[行动]{检查锁着的门，寻找撬痕} --risk mid
```

### 2) 询问 NPC
```
[对话]"神父，那七个人是谁？"
```

### 3) 系统性调查
```
[行动]{检查地面血迹，推断有人多久前来} --risk mid --intent "寻找最近访客的证据"
```

### 4. 回忆线索
```
<OOC> 回忆关于裂缝运动模式的线索
```

### 5) 战斗回合
```
[战斗]{用睡眠术覆盖门口，然后撤退 5 米}
```

### 6) 使用物品
```
[行动]{点燃油灯，照亮通道} --intent "照明"
```

### 7) 检查状态
```
[管理]{状态}
```

### 8) 使用 HUD 短码（推荐）
```
[行动]{与 N1 对话}
```

### 9) 内心触发
```
[内心]{学者} ← DM 会自动插入学者声音
```

---

## I) 玩家友好规则

1. **使用自然语言**：说"锁着的门"而不是 `loc_xxx`
2. **添加 [标签]**：让我知道你试图做什么类型的事情
3. **需要帮助**：查看 HUD 短码菜单，直接复制粘贴
4. **OOC 问题**：使用 `<OOC>` 标签
5. **新战役**：使用 `<初始化>` 开始配置（角色和偏好）

---

*CLI_SPEC.md v2.0 - RPG 游戏模板*
